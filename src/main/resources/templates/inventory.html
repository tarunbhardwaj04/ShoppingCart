<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Inventory List</title>
    <link rel="stylesheet" th:href="@{/style.css?v=2}">
</head>

<body>

    <div class="container">

        <h1>Alpha Grade Super Market üõí</h1>



        <div style="margin-bottom: 25px;">
            <a th:href="@{/cart/add}">
                <button class="btn-primary">Add New Item ‚ûï</button>
            </a>
        </div>

        <table>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th style="text-align: right;">Price</th>
                <th>Qty</th>
                <th>Actions</th>
            </tr>

            <tr th:each="item, stat : ${inventory}">
                <td th:text="${stat.count}"></td>
                <td th:text="${item.name}"></td>
                <td class="price-column">
                    ‚Çπ <span th:text="${#numbers.formatDecimal(item.price, 0, 'COMMA', 2, 'POINT')}"></span>
                </td>
                <td th:class="${item.quantity < 5} ? 'qty-low' : 'qty-normal'" th:text="${item.quantity}">
                </td>

                <td class="action-cell">
                    <button class="btn-delete" th:onclick="'openDeleteModal(' + ${item.id} + ')'">Delete</button>

                    <button class="btn-add-item-in-cart" th:onclick="'openQuantityModal(' + ${item.id} + ')'">Add Item
                        in Cart</button>

                    <div class="dropdown">
                        <a href="javascript:void(0)">
                            <button class="btn-update">Actions ‚ñæ</button>
                        </a>

                        <div class="dropdown-content">

                            <a th:href="@{'/cart/updatePriceForm/' + ${item.id}}">Update Price</a>
                            <a th:href="@{'/cart/updateNameForm/' + ${item.id}}">Update Name</a>
                            <a th:href="@{'/cart/updateQuantityForm/' + ${item.id}}">Update Qty</a>
                        </div>
                    </div>
                </td>
            </tr>
        </table>

        <!-- Pagination Controls -->
        <div th:if="${totalPages > 1}" style="text-align: center; margin-bottom: 20px;">
            <div style="display: inline-block;">
                <a th:if="${currentPage > 1}" th:href="@{'/cart/inventory?pageNo=' + ${currentPage - 1}}">
                    <button class="btn-primary" style="padding: 8px 15px;">&laquo; Previous</button>
                </a>

                <span style="font-weight: bold; margin: 0 10px; font-size: 16px;">
                    Page <span th:text="${currentPage}"></span> of <span th:text="${totalPages}"></span>
                </span>

                <a th:if="${currentPage < totalPages}" th:href="@{'/cart/inventory?pageNo=' + ${currentPage + 1}}">
                    <button class="btn-primary" style="padding: 8px 15px;">Next &raquo;</button>
                </a>
            </div>
            <div style="margin-top: 10px; color: #777;">
                Total Items: [[${totalItems}]]
            </div>
        </div>

        <div class="floating-action-buttons">
            <a th:href="@{/cart/viewCart}">
                <button class="btn-primary" style="margin-right: 0;">View Cart üõçÔ∏è</button>
            </a>
            <a th:href="@{/cart/bill}">
                <button class="btn-primary">View Bill üßæ</button>
            </a>
        </div>

    </div>

    <!-- Quantity Modal -->
    <div id="quantityModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeQuantityModal()">&times;</span>
            <h2>Select Quantity</h2>
            <form th:action="@{/cart/addToCart}" method="post">
                <input type="hidden" id="modalItemId" name="id" />
                <input type="number" name="quantity" class="modal-input" value="1" min="1" required />
                <br />
                <button type="submit" class="modal-btn">Add to Cart</button>
            </form>
        </div>
    </div>


    <!-- Error Modal -->
    <div id="errorModal" class="modal">
        <div class="modal-content" style="border-left: 5px solid #d9534f;">
            <span class="close" onclick="closeErrorModal()">&times;</span>
            <h2 style="color: #d9534f;">‚ö†Ô∏è Error</h2>
            <p id="errorMessage" th:text="${error}" style="font-size: 18px; margin: 20px 0;"></p>
            <button class="modal-btn" onclick="closeErrorModal()" style="background-color: #d9534f;">OK</button>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="modal">
        <div class="modal-content" style="border-left: 5px solid #28a745;">
            <span class="close" onclick="closeSuccessModal()">&times;</span>
            <h2 style="color: #28a745;">Success! ‚úÖ</h2>
            <p id="successMessage" th:text="${success}" style="font-size: 18px; margin: 20px 0;"></p>
            <button class="modal-btn" onclick="closeSuccessModal()" style="background-color: #28a745;">OK</button>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal">
        <div class="modal-content" style="border-left: 5px solid #d9534f;">
            <span class="close" onclick="closeDeleteModal()">&times;</span>
            <h2 style="color: #d9534f;">Confirm Delete ‚ö†Ô∏è</h2>
            <p style="font-size: 18px; margin: 20px 0;">Are you sure you want to delete this item?</p>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="modal-btn" onclick="closeDeleteModal()"
                    style="background-color: #95a5a6; flex: 1;">Cancel</button>
                <button class="modal-btn" onclick="confirmDelete()" style="background-color: #d9534f; flex: 1;">Yes,
                    Delete</button>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        /*<![CDATA[*/
        var errorMsg = /*[[${error}]]*/ null;
        var successMsg = /*[[${success}]]*/ null;
        var itemToDeleteId = null;

        if (errorMsg) {
            document.getElementById('errorModal').style.display = "block";
        }
        if (successMsg) {
            var sModal = document.getElementById('successModal');
            sModal.style.display = "block";
            // Auto-close after 2 seconds
            setTimeout(function () {
                sModal.style.display = "none";
            }, 2000);
        }
        /*]]>*/

        function closeErrorModal() {
            document.getElementById('errorModal').style.display = "none";
        }

        function closeSuccessModal() {
            document.getElementById('successModal').style.display = "none";
        }

        // --- Delete Modal Functions ---
        function openDeleteModal(id) {
            itemToDeleteId = id;
            document.getElementById('deleteModal').style.display = "block";
        }

        function closeDeleteModal() {
            itemToDeleteId = null;
            document.getElementById('deleteModal').style.display = "none";
        }

        function confirmDelete() {
            if (itemToDeleteId) {
                window.location.href = '/cart/delete/' + itemToDeleteId;
            }
        }

        function openQuantityModal(itemId) {
            document.getElementById('modalItemId').value = itemId;
            document.getElementById('quantityModal').style.display = "block";
        }

        function closeQuantityModal() {
            document.getElementById('quantityModal').style.display = "none";
        }

        // Close modal if user clicks outside of it
        window.onclick = function (event) {
            var qModal = document.getElementById('quantityModal');
            var eModal = document.getElementById('errorModal');
            var dModal = document.getElementById('deleteModal');
            if (event.target == qModal) {
                qModal.style.display = "none";
            }
            if (event.target == eModal) {
                eModal.style.display = "none";
            }
            if (event.target == dModal) {
                dModal.style.display = "none";
            }
        }
    </script>
</body>

</html>